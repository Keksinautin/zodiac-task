<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Zodiac test 376SU-M66AC-JOLDJ-UEH7</title>

    <style>
        body {
            margin: 0;
            padding: 0;
        }

        pre {
            margin: 0;
            padding: 0;
        }

        .game-area {
            background-color: #DDDDDD;
            margin: auto;
            padding: 1px;
            position: relative;
            width: 500px;
        }

        .display {
            margin: 150px 5px;
            position: relative;
        }


        .roll-display {
            border: 2px solid #444444;
            display: inline-block;
            height: 210px;
            margin: 0 5px;
            position: relative;
            width: 30px;
        }

        .roll {
            position: absolute;
            top: -120px;
        }

        .roll-cell {
            font-size: 24px;
            font-weight: bold;
            height: 30px;
            text-align: center;
            width: 30px;
            color: #8A6D3B;
        }

        .empty-cell {
            color: #888;
        }

        .finish-line {
            border: 1px solid #3C763D;
            position: absolute;
            top: 105px;
            width: 200px;
        }

    </style>
    <script>
        //noinspection ThisExpressionReferencesGlobalObjectJS
        (function (window, undefined){
            'use strict';

            window.onload = function(){
                var doc = window.document,

                    displayElement  = doc.getElementById('display'),
                    rollDisplay1    = displayElement.firstElementChild,
                    roll1           = rollDisplay1.firstElementChild,
                    toll1StartTop   = parseInt(window.getComputedStyle(roll1, null).top),
                    rollDisplayHigh = parseInt(window.getComputedStyle(rollDisplay1, null).height),
                    rollCellHigh    = parseInt(window.getComputedStyle(roll1.firstElementChild, null).height),

                    runRoll = function() {
                        var iterationTime = 250,    //mSec
                            totalShift    = 11520,  //px
                            timeRolling   = 6000,   //mSec

                            iterationTotalCount = window.Math.ceil(timeRolling / iterationTime), //24
                            startSpeed          = (2 * totalShift) / iterationTotalCount,
                            deceleration        = startSpeed / iterationTotalCount,

                            iterationCurrentNum = 0,
                            currentAdditionalShift = 0,
                            passedShift = 0,
                            timerId,

                            intervalRotator = function(){
                                var currentShift,
                                    requiredShift,
                                    movedCount,
                                    additionalShift,
                                    additionalMoved;

                                if (++iterationCurrentNum === iterationTotalCount) {
                                    window.clearInterval(timerId);
                                    currentShift = totalShift;
                                } else {
                                    currentShift = window.Math.round(
                                            startSpeed * iterationCurrentNum -
                                                (deceleration * window.Math.pow(iterationCurrentNum, 2)) / 2
                                    );
                                }

                                requiredShift = currentShift - passedShift;

                                if (requiredShift > 0) {
                                    movedCount = window.Math.floor(requiredShift / rollCellHigh);
                                    additionalShift = requiredShift - movedCount * rollCellHigh +
                                            currentAdditionalShift;

                                    if (additionalShift > 0) {
                                        if (additionalShift >= rollCellHigh) {
                                            additionalMoved = window.Math.floor(additionalShift / rollCellHigh);
                                            movedCount += additionalMoved;
                                            additionalShift = additionalShift - additionalMoved * rollCellHigh;
                                        }
                                        currentAdditionalShift = additionalShift;
                                        //TODO: mov roll-element (roll1)
                                    }

                                    if (movedCount > 0) {
                                        //TODO: move elements
                                    }
                                }


                                passedShift = currentShift;
                                console.table(
                                        [{
                                            iNum: iterationCurrentNum,
                                            curShift: currentShift,
                                            reqShift: requiredShift,
                                            movCount: movedCount,
                                            movCount1: window.Math.floor(requiredShift / rollCellHigh),
                                            addShift: additionalShift,
                                            addShift1: requiredShift - window.Math.floor(requiredShift / rollCellHigh) * rollCellHigh,
                                            currAddShift: currentAdditionalShift
                                        }]
                                );

                            };

                        timerId = window.setInterval(intervalRotator, iterationTime);
                        intervalRotator();

                        console.log(toll1StartTop, startSpeed, deceleration);


                    };

                runRoll();



            };
        })(this);

    </script>
</head>
<body>

    <div class="game-area">

        <div class="display" id="display">
            <div class="roll-display">
                <div class="roll">
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>2</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>1</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell">            <pre>C</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell">            <pre>7</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>1</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>3</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>2</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>1</pre> </div>
                </div>
            </div>
            <div class="roll-display">
                <div class="roll">
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>2</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>1</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell">            <pre>C</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell">            <pre>7</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>1</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>3</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>2</pre> </div>
                    <div class="roll-cell empty-cell"> <pre> </pre> </div>
                    <div class="roll-cell ">           <pre>1</pre> </div>
                </div>
            </div>
            <div class="finish-line"></div>
        </div>
    </div>

</body>
</html>